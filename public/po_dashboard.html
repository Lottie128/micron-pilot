<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Micron PO Tracking - Live Dashboard</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1600px; margin: 0 auto; }
        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .header h1 { color: #333; margin-bottom: 5px; }
        .header p { color: #666; font-size: 14px; }
        .po-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .po-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
        }
        .po-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        .po-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .po-number {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-in_progress { background: #fef3c7; color: #92400e; }
        .status-completed { background: #d1fae5; color: #065f46; }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s;
        }
        .stage-flow {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        .stage-item {
            background: #f9fafb;
            padding: 10px;
            border-radius: 6px;
            border-left: 4px solid #e5e7eb;
        }
        .stage-item.completed { border-color: #10b981; background: #ecfdf5; }
        .stage-item.in_progress { border-color: #f59e0b; background: #fffbeb; }
        .loading { text-align: center; padding: 40px; color: white; font-size: 18px; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        const API_BASE = '/api';
        
        function PODashboard() {
            const [loading, setLoading] = useState(true);
            const [pos, setPOs] = useState([]);
            const [selectedPO, setSelectedPO] = useState(null);
            
            useEffect(() => {
                loadPOs();
                const interval = setInterval(loadPOs, 10000);
                return () => clearInterval(interval);
            }, []);
            
            const loadPOs = async () => {
                try {
                    const response = await fetch(`${API_BASE}/po_tracking.php`);
                    const data = await response.json();
                    if (data.success) {
                        setPOs(data.purchase_orders);
                    }
                    setLoading(false);
                } catch (error) {
                    console.error('Failed to load POs:', error);
                    setLoading(false);
                }
            };
            
            const loadPODetails = async (poNumber) => {
                try {
                    const response = await fetch(`${API_BASE}/po_tracking.php?po_number=${poNumber}`);
                    const data = await response.json();
                    if (data.success) {
                        setSelectedPO(data.purchase_order);
                    }
                } catch (error) {
                    console.error('Failed to load PO details:', error);
                }
            };
            
            if (loading) {
                return <div className="loading">‚è≥ Loading purchase orders...</div>;
            }
            
            return (
                <div className="container">
                    <div className="header">
                        <h1>üìã Purchase Order Tracking</h1>
                        <p>Real-time PTO manufacturing progress by PO</p>
                    </div>
                    
                    <div className="po-grid">
                        {pos.map(po => {
                            const progress = po.total_ordered > 0 
                                ? Math.round((po.total_produced / po.total_ordered) * 100) 
                                : 0;
                            
                            return (
                                <div 
                                    key={po.id} 
                                    className="po-card"
                                    onClick={() => loadPODetails(po.po_number)}
                                >
                                    <div className="po-header">
                                        <div className="po-number">{po.po_number}</div>
                                        <span className={`status-badge status-${po.status}`}>
                                            {po.status.replace('_', ' ').toUpperCase()}
                                        </span>
                                    </div>
                                    
                                    <div style={{color: '#666', marginBottom: '10px'}}>
                                        <strong>{po.customer_name}</strong>
                                    </div>
                                    
                                    <div style={{fontSize: '14px', color: '#666', marginBottom: '10px'}}>
                                        {po.total_items} items ¬∑ {po.total_ordered} units ordered
                                    </div>
                                    
                                    <div className="progress-bar">
                                        <div className="progress-fill" style={{width: `${progress}%`}}></div>
                                    </div>
                                    
                                    <div style={{fontSize: '12px', color: '#666', marginTop: '5px'}}>
                                        Progress: {progress}% ({po.total_produced}/{po.total_ordered})
                                    </div>
                                    
                                    {po.total_rejected > 0 && (
                                        <div style={{fontSize: '12px', color: '#ef4444', marginTop: '5px'}}>
                                            ‚ö†Ô∏è {po.total_rejected} rejected
                                        </div>
                                    )}
                                </div>
                            );
                        })}
                    </div>
                    
                    {selectedPO && (
                        <div style={{background: 'white', padding: '30px', borderRadius: '10px', marginTop: '20px'}}>
                            <h2 style={{marginBottom: '20px'}}>üì¶ {selectedPO.po_number} - Detailed View</h2>
                            
                            {selectedPO.items && selectedPO.items.map(item => (
                                <div key={item.id} style={{marginBottom: '30px', padding: '20px', background: '#f9fafb', borderRadius: '10px'}}>
                                    <h3 style={{marginBottom: '15px'}}>{item.part_number} - {item.part_name}</h3>
                                    
                                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '15px', marginBottom: '20px'}}>
                                        <div>
                                            <div style={{fontSize: '12px', color: '#666'}}>Ordered</div>
                                            <div style={{fontSize: '24px', fontWeight: 'bold'}}>{item.ordered_quantity}</div>
                                        </div>
                                        <div>
                                            <div style={{fontSize: '12px', color: '#666'}}>Produced</div>
                                            <div style={{fontSize: '24px', fontWeight: 'bold', color: '#10b981'}}>{item.produced_quantity}</div>
                                        </div>
                                        <div>
                                            <div style={{fontSize: '12px', color: '#666'}}>Rejected</div>
                                            <div style={{fontSize: '24px', fontWeight: 'bold', color: '#ef4444'}}>{item.rejected_quantity}</div>
                                        </div>
                                        <div>
                                            <div style={{fontSize: '12px', color: '#666'}}>Rework</div>
                                            <div style={{fontSize: '24px', fontWeight: 'bold', color: '#f59e0b'}}>{item.rework_quantity}</div>
                                        </div>
                                    </div>
                                    
                                    {item.current_bin && (
                                        <div style={{padding: '10px', background: '#dbeafe', borderRadius: '6px', marginBottom: '15px'}}>
                                            <strong>üìç Current Location:</strong> {item.current_bin.bin_barcode} - {item.current_bin.bin_name} ({item.current_bin.quantity} units)
                                        </div>
                                    )}
                                    
                                    <h4 style={{marginBottom: '10px'}}>Stage Progress:</h4>
                                    <div className="stage-flow">
                                        {item.stage_progress && item.stage_progress.map((stage, idx) => (
                                            <div key={idx} className={`stage-item ${stage.stage_status}`}>
                                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                                    <div>
                                                        <strong>{stage.stage_name}</strong>
                                                        <span style={{marginLeft: '10px', fontSize: '12px', color: '#666'}}>
                                                            {stage.stage_status === 'completed' ? '‚úì Completed' : 
                                                             stage.stage_status === 'in_progress' ? '‚è≥ In Progress' : '‚è∏ Not Started'}
                                                        </span>
                                                    </div>
                                                    <div style={{fontSize: '14px'}}>
                                                        {stage.output_qty > 0 && `Output: ${stage.output_qty}`}
                                                        {stage.rejected_qty > 0 && ` | Rejected: ${stage.rejected_qty}`}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }
        
        ReactDOM.render(<PODashboard />, document.getElementById('root'));
    </script>
</body>
</html>
